#!/bin/bash
set -e # exit on command errors (so you MUST handle exit codes properly!)

INPUT_FOLDER="samples"
OUTPUT_FOLDER="output"

CURR_DIR=$(dirname "$0")
SCRIPT_PATH="$CURR_DIR/manifest.py"

usage() {
	echo "Usage: $0 [-i input_folder] [-o output_folder]" 1>&2
	exit 1
}

while getopts ":i::o::h" opt; do
	case "${opt}" in
	i)
		INPUT_FOLDER=${OPTARG}
		;;
	o)
		OUTPUT_FOLDER=${OPTARG}
		;;
	*)
		usage #Help
		;;
	esac
done
shift $((OPTIND - 1))

if [ -z "$INPUT_FOLDER" ]; then
	exit 1
fi

FILES="$INPUT_FOLDER/*.apk"
for file in $FILES; do
	echo "$file"
	python3 "$SCRIPT_PATH" -a "$file" -o "$OUTPUT_FOLDER"
done
