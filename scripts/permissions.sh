
#!/bin/bash
set -e          # exit on command errors (so you MUST handle exit codes properly!)

INPUT=""
OUTPUT_FOLDER="output/"

# Parse Parameters (get input file and output folder)
for ARG in $*; do
  case $ARG in
    -i|--input)
      shift && INPUT="$1" && shift
      ;;
    -o|--output)
      shift && OUTPUT_FOLDER="$1" && shift
      ;;
    *)
      break
      ;;
  esac
done

if [ -z "$INPUT" ]; then
    exit 1
fi
# get apk name
FILENAME=$(basename "$INPUT")

#use aapt tool to get the list of permissions
PERMS=`aapt dump permissions "$INPUT"`
#retrieve only the name if the permissions
PERMS=`echo "$PERMS" | grep -oP "(?<=').*?(?=')"`

#clean the file if it was already used
truncate -s 0 "$OUTPUT_FOLDER/${FILENAME}.txt"
#write permissions in the output file
echo "$PERMS" >> "$OUTPUT_FOLDER/${FILENAME}.txt"


